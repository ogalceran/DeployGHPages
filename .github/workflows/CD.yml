name: CD

on: 
  workflow_dispatch:

jobs:
  run_tests:
    uses: ogalceran/DeployGHPages/.github/workflows/template_codeverify_runtests.yml@main
  
  Deploy_GH_Pages:
    needs: run_tests
    runs-on: ubuntu-latest
    steps:
      - name: Setup Pages
        if: github.ref == 'refs/heads/main'
        uses: actions/configure-pages@v5
      
      - name: Upload Artifact
        if: github.ref == 'refs/heads/main'
        uses: actions/upload-pages-artifact@v3.0.1
        with:
          # location of the coverage artifacts
          path: "./coverage"
  deploy-coverage:
        if: github.ref == 'refs/heads/main'
        runs-on: ubuntu-latest      
        permissions:
          pages: write
          id-token: write

        environment:
          # environment created automatically by GitHub
          name: github-pages
          url: ${{ steps.deployment.outputs.page_url }}

        steps:
          - name: Deploy to GitHub Pages
            id: deployment
            uses: actions/deploy-pages@v4.0.5
